{"mappings":"6YAAA,IAAAA,EAAAC,EAAA,S,aAGA,MAAMC,EACJ,8GAyBFC,eAAeC,IACb,MAAMC,EAAiBC,SAASC,eAAe,YAC/C,GAAKF,GAAoBA,aAA0BG,kBAAnD,CACAH,EAAeI,UAAW,EAC1BJ,EAAeK,MAAMC,OAAS,cAC9BN,EAAeK,MAAME,QAAU,MAC/BP,EAAeQ,YAAc,6CAE7B,IACE,MAAMC,QAAiBC,MAAM,2BAA4B,CACvDC,OAAQ,OACRC,QAAS,CACP,eAAgB,oBAElBC,KAAMC,KAAKC,UAAU,CACnBC,YAhCNC,QAAQC,IAAI,kBAAmBC,EAAAC,MACxBC,OAAOC,KAAKH,EAAAC,MAAMG,KAAKC,IAC5B,MAAMC,EAAQC,OAAOF,GACrB,MAAO,CACLG,WAAY,CACVC,SAAU,MACVC,aAAc,CACZC,KAAMX,EAAAC,KAAKK,GAAOM,QAAQC,MAC1BC,OAAQ,CAACd,EAAAC,KAAKK,GAAOM,QAAQE,OAAO,KAEtCC,YAAyC,IAA5Bf,EAAAC,KAAKK,GAAOM,QAAQI,OAEnCC,SAAUjB,EAAAC,KAAKK,GAAOW,SACxB,KAoBIC,KAAM,UACNC,YAAa,gCACbC,WAAY,mCAGVC,QAAa/B,EAASgC,OAE5BxB,QAAQC,IAAIsB,GAGZ,MAAME,QAjDV5C,iBAEE,aADqBF,EAAA,UACP+C,WAAW9C,EAC3B,CA8CyB+C,SAEfF,GAAQG,mBAAmB,CAC/BC,UAAWN,EAAKO,QAAQvB,KAE5B,CAAE,MAAOwB,GACP/B,QAAQ+B,MAAM,QAASA,GACvBhD,EAAeI,UAAW,EAC1BJ,EAAeK,MAAMC,OAAS,UAC9BN,EAAeK,MAAME,QAAU,IAC/BP,EAAeQ,YAAc,0CAC/B,CAnCuE,CAsCzE,CAEA,MAAMyC,EAAkB,IACJ5B,OAAOC,KAAKH,EAAAC,MAAMG,KAAKC,IACvC,MAAMC,EAAQC,OAAOF,GACrB,MAAO,uEAEeL,EAAAC,KAAKK,GAAOM,QAAQP,2BAC1BL,EAAAC,KAAKK,GAAOM,QAAQE,OAAO,uBACjCd,EAAAC,KAAKK,GAAOM,QAAQC,0CAEjBb,EAAAC,KAAKK,GAAOM,QAAQI,yCACXhB,EAAAC,KAAKK,GAAOW,qCAEjC,IAEcc,KAAK,IAGT,SAAAC,KACb,EAAAxD,EAAAyD,SAAO,+CAGDH,wBACU5B,OAAOC,KAAKH,EAAAC,MAAMiC,QAC5B,CAACC,EAAK9B,IACJ8B,EAAMnC,EAAAC,KAAKM,OAAOF,IAAKO,QAAQI,MAAQhB,EAAAC,KAAKM,OAAOF,IAAKY,UAC1D,4FAKNnC,UAAUC,eAAe,aAAaqD,iBAAiB,QAASxD,EAClE,C,sCCtGAyD,EAAAC,QAAiBC,OAAoB,KAAO9D,EAAA,SAAA+D,QAA6C,UAAWC,MAAK,IAAMhE,EAAc,U","sources":["src/pages/Checkout.ts","node_modules/@parcel/runtime-js/lib/runtime-09a95c3c2e19fc73.js"],"sourcesContent":["import render from \"../components/render\"\r\nimport { cart } from \"../features/cart\"\r\n\r\nconst STRIPE_PUBLIC_KEY =\r\n  \"pk_test_51Ls3YjJiFO7cOn9i5GWxoJdBk5iN6FnUgdaHgD2wBxN7bqVFfcMKXQI4v86fwqhxe4b8CjYOKZNjg2VrcU2yply200OxYQlFCt\"\r\n\r\nasync function dynamicStripeLoader() {\r\n  const stripe = await import(\"@stripe/stripe-js\")\r\n  return stripe.loadStripe(STRIPE_PUBLIC_KEY)\r\n}\r\n\r\nfunction createLineItems() {\r\n  console.log(\"createLineItems\", cart)\r\n  return Object.keys(cart).map((id) => {\r\n    const idNum = Number(id)\r\n    return {\r\n      price_data: {\r\n        currency: \"usd\",\r\n        product_data: {\r\n          name: cart[idNum].product.title,\r\n          images: [cart[idNum].product.images[0]],\r\n        },\r\n        unit_amount: cart[idNum].product.price * 100,\r\n      },\r\n      quantity: cart[idNum].quantity,\r\n    }\r\n  })\r\n}\r\n\r\nasync function createSession() {\r\n  const checkoutButton = document.getElementById(\"checkout\")\r\n  if (!checkoutButton || !(checkoutButton instanceof HTMLButtonElement)) return\r\n  checkoutButton.disabled = true\r\n  checkoutButton.style.cursor = \"not-allowed\"\r\n  checkoutButton.style.opacity = \"0.5\"\r\n  checkoutButton.textContent = \"Redirecting to Stripe... HOLD YOUR HORSES!\"\r\n\r\n  try {\r\n    const response = await fetch(\"/create-checkout-session\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({\r\n        line_items: createLineItems(),\r\n        mode: \"payment\",\r\n        success_url: \"http://localhost:3001/success\",\r\n        cancel_url: \"http://localhost:3001/cancel\",\r\n      }),\r\n    })\r\n    const data = await response.json()\r\n\r\n    console.log(data)\r\n\r\n    // This is the official way to do it.\r\n    const stripe = await dynamicStripeLoader()\r\n\r\n    await stripe?.redirectToCheckout({\r\n      sessionId: data.session.id,\r\n    })\r\n  } catch (error) {\r\n    console.error(\"error\", error)\r\n    checkoutButton.disabled = false\r\n    checkoutButton.style.cursor = \"pointer\"\r\n    checkoutButton.style.opacity = \"1\"\r\n    checkoutButton.textContent = \"Hmmm... Something went wrong. Try again?\"\r\n  }\r\n  // Or, you can just do this, lol.\r\n  // location.href = data.session.url\r\n}\r\n\r\nconst renderCartItems = () => {\r\n  const cartItems = Object.keys(cart).map((id) => {\r\n    const idNum = Number(id)\r\n    return `\r\n      <div style=\"margin-bottom: 1rem;\">\r\n      <a href=\"/product/${cart[idNum].product.id}\">\r\n        <img src=\"${cart[idNum].product.images[0]}\" />\r\n        <h2>${cart[idNum].product.title}</h2>\r\n      </a>\r\n        <span>$${cart[idNum].product.price}</span>\r\n        <span>Quantity: ${cart[idNum].quantity}</span>\r\n      </div>\r\n    `\r\n  })\r\n  return cartItems.join(\"\")\r\n}\r\n\r\nexport default function Checkout() {\r\n  render(`\r\n    <div>\r\n      <h1>Checkout</h1>\r\n      ${renderCartItems()}\r\n      <p>Total: ${Object.keys(cart).reduce(\r\n        (acc, id) =>\r\n          acc + cart[Number(id)].product.price * cart[Number(id)].quantity,\r\n        0\r\n      )}</p>\r\n      <button id=\"checkout\">Checkout (Redirect to Stripe)</button>\r\n    </div>\r\n`)\r\n  document?.getElementById(\"checkout\")?.addEventListener(\"click\", createSession)\r\n}\r\n","module.exports = (__parcel__import__(\"./\" + require('./helpers/bundle-manifest').resolve(\"4DaNn\"))).then(() => parcelRequire('3knZs'));"],"names":["$eOHur","parcelRequire","$139f54551c540ff4$var$STRIPE_PUBLIC_KEY","async","$139f54551c540ff4$var$createSession","checkoutButton","document","getElementById","HTMLButtonElement","disabled","style","cursor","opacity","textContent","response","fetch","method","headers","body","JSON","stringify","line_items","console","log","$1GhVf","cart","Object","keys","map","id","idNum","Number","price_data","currency","product_data","name","product","title","images","unit_amount","price","quantity","mode","success_url","cancel_url","data","json","stripe","loadStripe","$139f54551c540ff4$var$dynamicStripeLoader","redirectToCheckout","sessionId","session","error","$139f54551c540ff4$var$renderCartItems","join","$139f54551c540ff4$export$2e2bcd8739ae039","default","reduce","acc","addEventListener","module","exports","import","resolve","then"],"version":3,"file":"Checkout.00024995.js.map"}